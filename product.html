<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product - Dondad Tech</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">Pajay Gadgets</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="login.html">Admin</a></li>
            </ul>
            <div class="nav-right">
                <div class="auth-links" id="auth-links">
                    <a href="login.html" class="auth-link">Login</a>
                    <a href="register.html" class="auth-link">Register</a>
                </div>
                <span id="user-greeting" class="user-greeting"></span>
                <a href="cart.html" class="cart-link" id="cart-link" style="display:none;">
                    <span>Cart</span>
                    <span class="cart-count">(<span id="cart-count">0</span>)</span>
                </a>
                <button id="logout-btn" class="logout-btn" onclick="logoutUser()" style="display: none;">Logout</button>
                <button class="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>

    <main>
        <section class="product-detail" id="product-detail">
            <div class="product-detail-image">
                <img id="product-image" src="" alt="Product">
            </div>
            <div class="product-detail-info">
                <h1 id="product-name"></h1>
                <p id="product-category" class="category-tag"></p>
                <p class="price" id="product-price"></p>
                <p class="desc" id="product-desc"></p>
                <div class="add-to-cart">
                    <div class="quantity-selector">
                        <button onclick="changeQty(-1)">-</button>
                        <input type="number" id="quantity" value="1" min="1">
                        <button onclick="changeQty(1)">+</button>
                    </div>
                    <button class="btn" id="add-to-cart-btn">Add to Cart</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Dondad Tech. All rights reserved.</p>
    </footer>

    <script src="products.js"></script>
    <script src="script.js"></script>
    <script>
        // Check if user is logged in and update UI
        document.addEventListener('DOMContentLoaded', function () {
            const currentUser = JSON.parse(localStorage.getItem('dondad_currentUser'));
            if (currentUser) {
                document.getElementById('auth-links').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'inline-block';
                document.getElementById('user-greeting').style.display = 'inline';
                document.getElementById('user-greeting').textContent = 'Hi, ' + currentUser.name;
                document.getElementById('cart-link').style.display = 'flex';
            }
            updateCartCount();
        });

        // Product detail page logic - Fetch from API
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        async function loadProduct() {
            try {
                const response = await fetch('/api/products/' + productId);
                if (response.ok) {
                    const product = await response.json();
                    document.getElementById('product-image').src = product.image;
                    document.getElementById('product-name').textContent = product.name;
                    document.getElementById('product-category').textContent = product.category;
                    document.getElementById('product-price').textContent = 'â‚¦' + product.price.toLocaleString();
                    document.getElementById('product-desc').textContent = product.desc;
                    document.title = product.name + ' - Dondad Tech';
                    
                    document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                        const qty = parseInt(document.getElementById('quantity').value);
                        // For MongoDB, use _id instead of id
                        addToCart(product._id, qty);
                    });
                } else {
                    document.querySelector('main').innerHTML =
                        '<p style="text-align:center; padding: 6rem 2rem;">Product not found</p>';
                }
            } catch (error) {
                console.error('Error loading product:', error);
                document.querySelector('main').innerHTML =
                    '<p style="text-align:center; padding: 6rem 2rem;">Error loading product</p>';
            }
        }
        
        loadProduct();

        function changeQty(delta) {
            const input = document.getElementById('quantity');
            const newVal = parseInt(input.value) + delta;
            if (newVal >= 1) input.value = newVal;
        }
    </script>
</body>

</html>
